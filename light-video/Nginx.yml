apiVersion: v1
data:
  nginx.conf: "upstream  PC_LIGHTVIDEO {\n   server x-light.pcvideo.com.cn;\n}\n\nupstream  WAP_LIGHTVIDEO {\n   server x-light.pcvideo.com.cn;\n} \n\nupstream  PC_LIGHTVIDEO_ADMIN {\n   server x-light.pcvideo.com.cn;\n} \n\n\nserver {\n\tlisten       81;\n\tserver_name  light.pcvideo.com.cn localhost 127.0.0.1 light-light-video-nginx-service x-light.pcvideo.com.cn;\n\n\n\t#### video #####\n\tlocation ~ ^/video/(.*)$ {\n\t\t\trewrite /video/(\\d*).html  /jsp/template/2016/art.jsp?videoId=$1 break;\n\t\t\tproxy_pass\t\t\thttp://PC_LIGHTVIDEO;\n\t\t\tproxy_redirect      off;\n            proxy_set_header    Domain           $Host;\n\t\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n    }\n\t\n\tlocation ~ ^/upload(.*) {\n\t\trewrite ^/upload.html /jsp/template/2016/video/uploadVideo.jsp break;\n\t\trewrite ^/upload/(\\d*).html /jsp/template/2016/video/uploadVideo.jsp?videoId=$1 break;\n\t\tproxy_pass\t\t\thttp://PC_LIGHTVIDEO;\n\t\tproxy_redirect      off;\n        proxy_set_header    Domain           $Host;\n\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n\t}\t\n\t\n\tlocation ~ ^/renzheng(.*)  {\n\t\trewrite ^/renzheng.html  /jsp/template/2016/personal/apply.jsp break;\n\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\tproxy_redirect      off;\n        proxy_set_header    Domain           $Host;\n\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n\t}\n\t\n\tlocation ~ ^/author(.*) {\n\t\trewrite ^/author/(\\d*).html /jsp/template/2016/author/author_index.jsp?userId=$1 break;\n\t\trewrite ^/author/(\\d*)/(\\d*).html /jsp/template/2016/author/author_index.jsp?userId=$1&pageNo=$2 break;\n\t\trewrite ^/author/fans/(\\d*)/(\\d*)/ /jsp/template/2016/author/author_fans.jsp?userId=$1&pageNo=$2 break;\n\t\trewrite ^/author/fans/(\\d*)/ /jsp/template/2016/author/author_fans.jsp?userId=$1 break;\n\t\trewrite ^/author/followers/(\\d*)/(\\d*)/ /jsp/template/2016/author/author_followers.jsp?userId=$1&pageNo=$2 break;\n\t\trewrite ^/author/followers/(\\d*)/ /jsp/template/2016/author/author_followers.jsp?userId=$1 break;\n\t\t\n\n\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\tproxy_redirect      off;\n        proxy_set_header    Domain           $Host;\n\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n\t}\t\n\t\n\tlocation ~ ^/recommend/user(.*) {\n\t\trewrite ^/recommend/user/(\\d*).html /jsp/template/2016/user_recommendlist.jsp?pageNo=$1 break;\n\t\trewrite ^/recommend/user/ /jsp/template/2016/user_recommendlist.jsp?pageNo=1 break;\t\t\n\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\tproxy_redirect      off;\n        proxy_set_header    Domain           $Host;\n\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n\t}\n\t\n\tlocation ~ ^/my(.*) {\n\t\trewrite ^/my/author.html /jsp/template/2016/personal/myRead.jsp break;\n\t\trewrite ^/my/author-(\\d*).html /jsp/template/2016/personal/myRead.jsp?pageNo=$1 break;\n\t\trewrite ^/my/video.html /jsp/template/2016/personal/verified.jsp?status=1 break;\n\t\trewrite ^/my/video/(\\d*).html /jsp/template/2016/personal/verified.jsp?status=1&pageNo=$1 break;\n\t\trewrite ^/my/pending.html /jsp/template/2016/personal/verified.jsp?status=0 break;\n\t\trewrite ^/my/pending/(\\d*).html /jsp/template/2016/personal/verified.jsp?status=0&pageNo=$1 break;\n\t\trewrite ^/my/nopass.html /jsp/template/2016/personal/verified.jsp?status=2 break;\n\t\trewrite ^/my/nopass/(\\d*).html /jsp/template/2016/personal/verified.jsp?status=2&pageNo=$1 break;\n\t\trewrite ^/my/favorite.html /jsp/template/2016/personal/myCollect.jsp break;\n\t\trewrite ^/my/favorite/(\\d*).html /jsp/template/2016/personal/myCollect.jsp?pageNo=$1 break;\n\t\trewrite ^/my/history.html /jsp/template/2016/personal/myHistory.jsp break;\n\t\trewrite ^/my/history/(\\d*).html /jsp/template/2016/personal/myHistory.jsp?pageNo=$1 break;\n\t\trewrite ^/my/comment/send/(\\d*).html /jsp/template/2016/personal/myCommentSend.jsp?pageNo=$1 break;\n\t\trewrite ^/my/comment/rec/(\\d*).html /jsp/template/2016/personal/myCommentRec.jsp?pageNo=$1 break;\n\t\trewrite ^/my/comment/send/ /jsp/template/2016/personal/myCommentSend.jsp break;\n\t\trewrite ^/my/comment/rec/ /jsp/template/2016/personal/myCommentRec.jsp break;\n\t\trewrite ^/my/fans/(\\d*)/ /jsp/template/2016/personal/myFans.jsp?pageNo=$1 break;\n\t\trewrite ^/my/fans/ /jsp/template/2016/personal/myFans.jsp break;\n\t\trewrite ^/my/followers/(\\d*)/ /jsp/template/2016/personal/myFollowers.jsp?pageNo=$1 break;\n\t\trewrite ^/my/followers/ /jsp/template/2016/personal/myFollowers.jsp break;\n\t\trewrite ^/my/notice/(\\d*).html /jsp/template/2016/personal/myNotice.jsp?pageNo=$1 break;\n\t\trewrite ^/my/notice/ /jsp/template/2016/personal/myNotice.jsp break;\n\t\trewrite ^/my/message/(\\d*).html /jsp/template/2016/personal/myMessage.jsp?pageNo=$1 break;\n\t\trewrite ^/my/message/ /jsp/template/2016/personal/myMessage.jsp break;\n\t\trewrite ^/my/messageDialogue/(\\d*)/(\\d*).html /jsp/template/2016/personal/myMessageDialogue.jsp?senderId=$1&pageNo=$2 break;\n\t\trewrite ^/my/messageDialogue/(\\d*)/ /jsp/template/2016/personal/myMessageDialogue.jsp?senderId=$1 break;\n\t\trewrite ^/my/information/ /jsp/template/2016/personal/myInformation.jsp break;\n\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\tproxy_redirect      off;\n        proxy_set_header    Domain           $Host;\n\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n        proxy_http_version 1.1;\n\t}\t\n\t\n\tlocation ~ ^/admin/ {\n\t        rewrite ^/admin/(.*)$  /admin/$1  break;\n            proxy_pass          http://PC_LIGHTVIDEO;\n            proxy_redirect      off;\n            proxy_set_header    Domain           $Host;\n            proxy_set_header    Host             x-light.pcvideo.com.cn;\n            proxy_set_header    X-Real-IP        $remote_addr;\n            proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n       }\n\n\t#### index#####\t    \n    location ~ ^/fenlei/(.*)$ {\n\t\t\trewrite ^/fenlei/(\\d*)/(\\d*)/$  /jsp/template/2016/index.jsp?typeId=$1&pageNo=$2 break;\n\t\t\trewrite ^/fenlei/(\\d*)/$  /jsp/template/2016/index.jsp?typeId=$1 break;\t\t\n\t\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\t\tproxy_redirect      off;\n            proxy_set_header    Domain           $Host;\n\t\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n    }    \n  \n\n    location ~ ^/tgflxq(.*) {\n\t\t\trewrite ^/tgflxq.html$  /jsp/template/2016/tgflxq.jsp break;\n\t\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\t\tproxy_redirect      off;\n            proxy_set_header    Domain           $Host;\n\t\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n    }\n\t\n\t\n\t########## wap start ##########\n    location ~ ^/light {\n    \t\trewrite ^/light($|/$)              /wap/index.jsp  break;\n\t\t\trewrite ^/light/fenlei/(\\d*)/$     /wap/index.jsp?typeId=$1 break;\n\t\t\trewrite ^/light/video/(\\d*).html   /wap/art.jsp?videoId=$1 break;\n\t\t\trewrite ^/light/search.html(.*)    /wap/query.jsp$1 break;\n\t\t\trewrite ^/light/comIntf/(.+)       /intf/$1 break;\n\t\t\trewrite ^/light/(.+)               /wap/$1  break;\n\t\t\tproxy_pass          http://PC_LIGHTVIDEO;\n\t\t\tproxy_redirect      off;\n            proxy_set_header    Domain           $Host;\n\t\t\tproxy_set_header    Host             x-light.pcvideo.com.cn;\n\t\t\tproxy_set_header    X-Real-IP        $remote_addr;\n\t\t\tproxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n    } \n\t########## wap end ##########\n\t\n       \n       location ~ ^/ {\n       \t\trewrite ^/(\\d*)/$  /jsp/template/2016/index.jsp?typeId=0&pageNo=$1 break;\n       \t\trewrite ^/$  /jsp/template/2016/index.jsp?typeId=0 break;\n\t\t\trewrite ^$  /jsp/template/2016/index.jsp?typeId=0 break;\n            rewrite ^/search.html(.*)  /jsp/template/2016/query.jsp$1 break;\n            proxy_pass          http://PC_LIGHTVIDEO;\n            proxy_redirect      off; \n            proxy_set_header    Domain           $Host;\n            proxy_set_header    Host             x-light.pcvideo.com.cn;\n            proxy_set_header    X-Real-IP        $remote_addr;\n            proxy_set_header    X-Forwarded-For  $proxy_add_x_forwarded_for;\n            proxy_http_version 1.1;\n        }\t\n        \n        \n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n}"
kind: ConfigMap
metadata:
  creationTimestamp: '2020-04-20T11:11:41Z'
  name: light-video-nginx-configmap
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: light-video-nginx-service
  name: light-video-nginx-service
spec:
  selector:
    app: light-video-nginx
  ports:
    - name: http
      port: 81
      protocol: TCP
      targetPort: 81
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: light-video-nginx-service
    service: light-video-nginx
  name: light-video-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: light-video-nginx
      service: light-video-nginx
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: light-video-nginx
        service: light-video-nginx
    spec:
      containers:
        - image: 'nginx:1.9.12'
          imagePullPolicy: IfNotPresent
          name: light-video-nginx
          ports:
            - containerPort: 80
              protocol: TCP
          resources: {}
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /etc/nginx/conf.d
              name: nginx-config
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
        - configMap:
            defaultMode: 420
            name: light-video-nginx-configmap
          name: nginx-config
